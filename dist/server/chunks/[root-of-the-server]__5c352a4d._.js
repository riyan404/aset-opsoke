module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},24960,e=>{"use strict";e.s(["generateToken",()=>n,"verifyToken",()=>a,"withAuth",()=>s,"withRole",()=>i]);var t=e.i(89171),r=e.i(24652);function a(e){try{return r.default.verify(e,process.env.JWT_SECRET)}catch(e){return null}}function n(e){return r.default.sign(e,process.env.JWT_SECRET,{expiresIn:"1d"})}function s(e){return async(r,n)=>{let s=r.headers.get("authorization");console.log("Middleware: Authorization header:",s);let i=s?.replace("Bearer ","");if(console.log("Middleware: Extracted token:",i?"Token exists":"No token"),!i)return console.log("Middleware: No token provided"),t.NextResponse.json({error:"Unauthorized"},{status:401});let o=a(i);return(console.log("Middleware: Token verification result:",o?"Valid":"Invalid"),o)?(r.user=o,e(r,n)):(console.log("Middleware: Invalid token"),t.NextResponse.json({error:"Invalid token"},{status:401}))}}function i(e){return function(r){return s(async(a,n)=>a.user&&e.includes(a.user.role)?r(a,n):t.NextResponse.json({error:"Forbidden"},{status:403}))}}},98043,e=>{"use strict";e.s(["prisma",()=>r]);var t=e.i(29173);let r=globalThis.prisma??new t.PrismaClient({datasources:{db:{url:process.env.DATABASE_URL}},log:["error"],__internal:{engine:{connectionLimit:5}}})},24285,e=>{"use strict";e.s(["logActivity",()=>r]);var t=e.i(98043);async function r(e,r,a,n,s,i,o,l){try{await t.prisma.auditLog.create({data:{userId:e,action:r,resource:a,resourceId:n,oldValues:s?JSON.stringify(s):null,newValues:i?JSON.stringify(i):null,ipAddress:o,userAgent:l}})}catch(e){console.error("Failed to log activity:",e)}}},48886,e=>{"use strict";e.s(["SYSTEM_MODULES",()=>a,"checkUserPermissions",()=>r]);let t=new(e.i(29173)).PrismaClient;async function r(e,r,a){try{if("ADMIN"===r)return{canRead:!0,canWrite:!0,canDelete:!0};if(!e)return{canRead:!0,canWrite:!1,canDelete:!1};let n=t.departmentPermission.findFirst({where:{department:e,module:a,isActive:!0}}),s=new Promise((e,t)=>setTimeout(()=>t(Error("Database query timeout")),3e3)),i=await Promise.race([n,s]);return i?{canRead:i.canRead,canWrite:i.canWrite,canDelete:i.canDelete}:{canRead:!0,canWrite:!1,canDelete:!1}}catch(e){return console.error("Error checking user permissions:",e),{canRead:!0,canWrite:!1,canDelete:!1}}}let a={ASSETS:"ASSETS",DOCUMENTS:"DOCUMENTS",DIGITAL_ASSETS:"DIGITAL_ASSETS",USERS:"USERS",AUDIT_LOGS:"AUDIT_LOGS",REPORTS:"REPORTS",SETTINGS:"SETTINGS"}},33775,(e,t,r)=>{},40052,e=>{"use strict";e.s(["handler",()=>k,"patchFetch",()=>I,"routeModule",()=>y,"serverHooks",()=>_,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>C],40052);var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(69741),o=e.i(16795),l=e.i(87718),d=e.i(95169),c=e.i(47587),u=e.i(66012),p=e.i(70101),m=e.i(26937),g=e.i(10372),h=e.i(93695);e.i(52474);var x=e.i(220);e.s(["GET",()=>S,"POST",()=>A],86055);var R=e.i(89171),v=e.i(98043),f=e.i(24960),w=e.i(24285),E=e.i(48886);let S=(0,f.withAuth)(async e=>{try{let t=e.user,{searchParams:r}=new URL(e.url),a=parseInt(r.get("page")||"1"),n=parseInt(r.get("limit")||"12"),s=r.get("search")||"",i=r.get("aspectRatio")||"",o=r.get("department")||"",l=(0,E.checkUserPermissions)(t.department,t.role,E.SYSTEM_MODULES.DIGITAL_ASSETS),d=new Promise((e,t)=>setTimeout(()=>t(Error("Permission check timeout")),5e3));if(!(await Promise.race([l,d])).canRead)return R.NextResponse.json({error:"Forbidden"},{status:403});let c=(a-1)*n,u={isActive:!0};s&&(u.OR=[{contentName:{contains:s}},{description:{contains:s}},{tags:{contains:s}}]),i&&(u.aspectRatio=i),o&&"all"!==o&&(u.department=o);let[p,m]=await Promise.all([v.prisma.digitalAsset.findMany({where:u,select:{id:!0,contentName:!0,description:!0,previewFile:!0,previewFileName:!0,previewFileSize:!0,aspectRatio:!0,googleDriveLink:!0,tags:!0,department:!0,createdAt:!0,updatedAt:!0,createdBy:{select:{firstName:!0,lastName:!0}}},orderBy:{createdAt:"desc"},skip:c,take:n}),v.prisma.digitalAsset.count({where:u})]),g=R.NextResponse.json({digitalAssets:p,pagination:{page:a,pages:Math.ceil(m/n),total:m,limit:n}});return g.headers.set("Cache-Control","no-cache, no-store, must-revalidate"),g.headers.set("Pragma","no-cache"),g.headers.set("Expires","0"),g}catch(e){return console.error("Failed to fetch digital assets:",e),R.NextResponse.json({error:"Failed to fetch digital assets"},{status:500})}}),A=(0,f.withAuth)(async e=>{try{let t,r=e.user;if(!(await (0,E.checkUserPermissions)(r.department,r.role,E.SYSTEM_MODULES.DIGITAL_ASSETS)).canWrite)return R.NextResponse.json({error:"You do not have permission to create digital assets"},{status:403});let a=e.headers.get("content-type"),n=null,s=null,i=null;if(a?.includes("multipart/form-data")){let r=await e.formData(),a=r.get("previewFile");if(t={contentName:r.get("contentName"),description:r.get("description"),aspectRatio:r.get("aspectRatio"),googleDriveLink:r.get("googleDriveLink"),tags:r.get("tags"),department:r.get("department")},a&&a.size>0){let e=await a.arrayBuffer();n=Buffer.from(e).toString("base64"),s=a.name,i=a.size}}else n=(t=await e.json()).previewFile,s=t.previewFileName,i=t.previewFileSize;let{contentName:o,description:l,aspectRatio:d,googleDriveLink:c,tags:u,department:p}=t;if(!o||!d)return R.NextResponse.json({error:"Content name and aspect ratio are required"},{status:400});if(!["RATIO_4_3","RATIO_9_16"].includes(d))return R.NextResponse.json({error:"Invalid aspect ratio. Must be RATIO_4_3 or RATIO_9_16"},{status:400});let m=await v.prisma.digitalAsset.create({data:{contentName:o,description:l,aspectRatio:d,googleDriveLink:c,previewFile:n,previewFileName:s,previewFileSize:i,tags:u,department:p||r.department||"Digital",createdById:r.id,updatedById:r.id},include:{createdBy:{select:{id:!0,firstName:!0,lastName:!0,email:!0}},updatedBy:{select:{id:!0,firstName:!0,lastName:!0,email:!0}}}}),g=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown";return await (0,w.logActivity)(r.id,"CREATE_DIGITAL_ASSET","DigitalAsset",m.id,null,m,g,e.headers.get("user-agent")||"unknown"),R.NextResponse.json({digitalAsset:m},{status:201})}catch(e){return console.error("Failed to create digital asset:",e),R.NextResponse.json({error:"Failed to create digital asset"},{status:500})}});var T=e.i(86055);let y=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/digital-assets/route",pathname:"/api/digital-assets",filename:"route",bundlePath:""},distDir:"dist",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/digital-assets/route.ts",nextConfigOutput:"standalone",userland:T}),{workAsyncStorage:N,workUnitAsyncStorage:C,serverHooks:_}=y;function I(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:C})}async function k(e,t,a){var R;let v="/api/digital-assets/route";v=v.replace(/\/index$/,"")||"/";let f=await y.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!f)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:S,isDraftMode:A,prerenderManifest:T,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:_,resolvedPathname:I}=f,k=(0,i.normalizeAppPath)(v),D=!!(T.dynamicRoutes[k]||T.routes[I]);if(D&&!A){let e=!!T.routes[I],t=T.dynamicRoutes[k];if(t&&!1===t.fallback&&!e)throw new h.NoFallbackError}let O=null;!D||y.isDev||A||(O="/index"===(O=I)?"/":O);let P=!0===y.isDev||!D,b=D&&!P,j=e.method||"GET",M=(0,s.getTracer)(),U=M.getActiveScopeSpan(),q={params:E,prerenderManifest:T,renderOpts:{experimental:{cacheComponents:!!S.experimental.cacheComponents,authInterrupts:!!S.experimental.authInterrupts},supportsDynamicResponse:P,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(R=S.experimental)?void 0:R.cacheLife,isRevalidate:b,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>y.onRequestError(e,t,a,N)},sharedContext:{buildId:w}},F=new o.NodeNextRequest(e),L=new o.NodeNextResponse(t),H=l.NextRequestAdapter.fromNodeNextRequest(F,(0,l.signalFromNodeResponse)(t));try{let i=async r=>y.handle(H,q).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${j} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${j} ${e.url}`)}),o=async s=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&C&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(s);e.fetchMetrics=q.renderOpts.fetchMetrics;let l=q.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=q.renderOpts.collectedTags;if(!D)return await (0,u.sendResponse)(F,L,o,q.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,a=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:C})},N),t}},h=await y.handleResponse({req:e,nextConfig:S,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:_,responseGenerator:d,waitUntil:a.waitUntil});if(!D)return null;if((null==h||null==(o=h.value)?void 0:o.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(l=h.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",C?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let R=(0,p.fromNodeOutgoingHttpHeaders)(h.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&D||R.delete(g.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||R.get("Cache-Control")||R.set("Cache-Control",(0,m.getCacheControlHeader)(h.cacheControl)),await (0,u.sendResponse)(F,L,new Response(h.value.body,{headers:R,status:h.value.status||200})),null};U?await o(U):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},o))}catch(t){if(U||t instanceof h.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:b,isOnDemandRevalidate:C})}),D)throw t;return await (0,u.sendResponse)(F,L,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5c352a4d._.js.map